<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Title -->
    <title>Blue Resort & Hotel</title>

    <!-- Favicon -->
    <link rel="icon" href="../img/core-img/favicon.ico" />

    <!-- Core Stylesheet -->
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="../css/breadcrumb.css" type="text/css" />
  </head>

  <body>
    <!-- Preloader -->
    <div class="preloader d-flex align-items-center justify-content-center">
      <div class="cssload-container">
        <div class="cssload-loading"><i></i><i></i><i></i><i></i></div>
      </div>
    </div>

    <!-- ##### Header Area Start ##### -->
    <header class="header-area">
      <!-- Navbar Area -->
      <div class="palatin-main-menu">
        <div class="classy-nav-container breakpoint-off">
          <div class="container">
            <!-- Menu -->
            <nav class="classy-navbar justify-content-between" id="palatinNav">
              <!-- Nav brand -->
              <a href="../index.html" class="nav-brand"
                ><img src="../img/core-img/logo.png" alt=""
              /></a>

              <!-- Navbar Toggler -->
              <div class="classy-navbar-toggler">
                <span class="navbarToggler"
                  ><span></span><span></span><span></span
                ></span>
              </div>

              <!-- Menu -->
              <div class="classy-menu">
                <!-- close btn -->
                <div class="classycloseIcon">
                  <div class="cross-wrap">
                    <span class="top"></span><span class="bottom"></span>
                  </div>
                </div>

                <!-- Nav Start -->
                <div class="classynav">
                  <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../rooms.html">Rooms</a></li>
                    <li><a href="../gallery.html">Gallery</a></li>
                    <li><a href="../about-us.html">About Us</a></li>
                    <li class="active">
                      <a href="../contact.html">Contact</a>
                    </li>
                  </ul>

                  <!-- Button -->
                  <div class="menu-btn">
                    <a href="../myBooking.html" class="btn palatin-btn"
                      >My Booking <i class="fa fa-search" aria-hidden="true"></i
                    ></a>
                  </div>
                </div>
                <!-- Nav End -->
              </div>
            </nav>
          </div>
        </div>
      </div>
    </header>
    <!-- ##### Header Area End ##### -->

    <!-- ##### Breadcumb Area Start ##### -->

    <section class="contact-form-area mb-100">
      <div class="container" style="margin-top: 10rem !important">
        <div class="bread">
          <div class="breadcrumb-pagination">
            <div class="completed">
              <a href="../index.html">
                <span>1</span>
                <p>Select Dates</p>
              </a>
            </div>
            <div class="completed">
              <a href="select_rooms.html">
                <span>2</span>
                <p>Rooms</p>
              </a>
            </div>
            <div class="completed">
              <a href="guest-details.html">
                <span>3</span>
                <p>Guest Detail</p>
              </a>
            </div>
            <div class="active">
              <a href="booking_details.html">
                <span>4</span>
                <p>Review</p>
              </a>
            </div>
            <div class="todo">
              <span>5</span>
              <p>Confirmation</p>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h3>Review your booking</h3>
              </div>
              <div class="card-body p-0">
                <div class="row pb-5 p-5 text-center">
                  <div class="col-md-6">
                    <p class="font-weight-bold mb-4">Guest Information</p>
                    <p class="mb-1" id="guest_name">
                      John Doe, Mrs Emma Downson
                    </p>

                    <p class="mb-1" id="guest_address">Berlin, Germany</p>
                    <p class="mb-1" id="guest_contact">6781 45P</p>
                    <p class="mb-1" id="guest_email"></p>
                  </div>

                  <div class="col-md-6">
                    <p class="font-weight-bold mb-4">Booking Details</p>
                    <p class="mb-1">
                      <span class="text-muted">Check-in: </span>
                      <b id="check_in"></b>
                    </p>
                    <p class="mb-1">
                      <span class="text-muted">Check-out: </span>
                      <b id="check_out"></b>
                    </p>
                    <p class="mb-1">
                      <span class="text-muted">No. Night(s): </span>
                      <b id="nights"></b>
                    </p>
                    <p class="mb-1">
                      <span class="text-muted">No. Guest: </span>
                      <b id="guest_num"></b>
                    </p>
                  </div>
                </div>

                <div class="row p-5">
                  <div class="col-md-12">
                    <table class="table" id="invoice">
                      <thead>
                        <tr>
                          <th
                            class="
                              border-0
                              text-uppercase
                              small
                              font-weight-bold
                            "
                          >
                            Availed Room
                          </th>
                          <th
                            class="
                              border-0
                              text-uppercase
                              small
                              font-weight-bold
                            "
                          >
                            Rate
                          </th>
                          <th
                            class="
                              border-0
                              text-uppercase
                              small
                              font-weight-bold
                            "
                          >
                            Night(s)
                          </th>
                          <th
                            class="
                              border-0
                              text-uppercase
                              small
                              font-weight-bold
                            "
                          >
                            Quantity
                          </th>
                          <th
                            class="
                              border-0
                              text-uppercase
                              small
                              font-weight-bold
                            "
                          >
                            Amount
                          </th>
                        </tr>
                      </thead>
                      <tbody id="#invoice"></tbody>
                      <tfoot>
                        <tr>
                          <th></th>
                          <th></th>
                          <th></th>
                          <th>Vatable Sales</th>
                          <th id="vatable"></th>
                        </tr>
                        <tr>
                          <th></th>
                          <th></th>
                          <th></th>
                          <th>VAT (12%)</th>
                          <th id="vat"></th>
                        </tr>
                        <tr>
                          <th></th>
                          <th></th>
                          <th></th>
                          <th>Sub Total</th>
                          <th id="sub_total"></th>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </div>

                <div class="d-flex flex-row-reverse bg-dark text-white p-4">
                  <div class="py-3 px-5 text-right">
                    <div class="mb-2">Total Amount</div>
                    <div class="h2 font-weight-light" id="total_amount"></div>
                  </div>

                  <!-- <div class="py-3 px-5 text-right">
                    <div class="mb-2">Discount</div>
                    <div class="h2 font-weight-light">10%</div>
                  </div> -->

                  <div class="py-3 px-5 text-right">
                    <div class="mb-2">Downpayment Amount</div>
                    <div class="h2 font-weight-light" id="downpayment"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="invoice-note">
              <div class="row">
                <div class="col-xl-6 col-lg-12">
                  <h4>HOW TO PAY ?</h4>
                  <p>
                    * Payment is available only for Bank Deposit <br />
                    * After Confirming, You will receive an Email w/ Booking
                    Number<br />
                    * Deposit your 50% Downpayment to bank, and upload your bank
                    receipt<br />
                    <a
                      class="text-primary"
                      href="https://bluegardenresort.com/mybookings.html"
                      >(click here to find your booking using your booking
                      number and email)</a
                    ><br />
                    * Wait your booking status to be confirmed.
                  </p>
                </div>
                <div class="col-xl-6 col-lg-12">
                  <h4>POLICY CONDITIONS</h4>
                  <p>
                    * You need to pay your 50% downpayment before 24hours or<br />
                    the reservation will be voided<br />
                    * Payment is strictly 50% downpayment only<br />
                    to be the reservation will be confirmed<br />
                    * No refund.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12 mt-2">
            <div class="invoice-footer">
              <button class="btn btn-primary btn-lg btn-block" id="confirm">
                CONFIRM
              </button>
              <!--  <p class="text-center m-b-5 f-w-600">
                THANK YOU FOR YOUR BUSINESS
              </p>
              <p class="text-center">
                <span class="m-r-10"
                  ><i class="fa fa-fw fa-lg fa-globe"></i>
                  matiasgallipoli.com</span
                >
                <span class="m-r-10"
                  ><i class="fa fa-fw fa-lg fa-phone-volume"></i>
                  T:016-18192302</span
                >
                <span class="m-r-10"
                  ><i class="fa fa-fw fa-lg fa-envelope"></i>
                  rtiemps@gmail.com</span
                >
              </p>-->
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- ##### Contact Form Area End ##### -->

    <!-- ##### Footer Area Start ##### -->
    <footer class="footer-area">
      <div class="container">
        <div class="row pt-5">
          <p class="col-md-8 text-left">
            Copyright Â©
            <script>
              document.write(new Date().getFullYear());
            </script>
            2021 All rights reserved | Blue Garden Resort
          </p>
          <p class="col-md-4 text-right social">
            <!-- <a href=""><span class="fa fa-tripadvisor"></span></a> -->
            <a href="https://www.facebook.com/blugarden" target="_blank"
              ><span class="fa fa-facebook"></span
            ></a>
            <!-- <a href="#"><span class="fa fa-twitter"></span></a>
            <a href="#"><span class="fa fa-linkedin"></span></a>
            <a href="#"><span class="fa fa-vimeo"></span></a> -->
          </p>
        </div>
      </div>
    </footer>
    <!-- ##### Footer Area End ##### -->

    <!-- ##### All Javascript Script ##### -->
    <!-- jQuery-2.2.4 js -->
    <script src="../js/jquery/jquery-2.2.4.min.js"></script>
    <!-- Popper js -->
    <script src="../js/bootstrap/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="../js/bootstrap/bootstrap.min.js"></script>
    <!-- All Plugins js -->
    <script src="../js/plugins/plugins.js"></script>
    <!-- Active js -->
    <script src="../js/active.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
  </body>

  <script>
    $(document).ready(() => {
      if (
        sessionStorage.getItem("checkin_date") == null ||
        sessionStorage.getItem("checkin_date") == null ||
        sessionStorage.getItem("room_details") == null ||
        sessionStorage.getItem("guest_details") == null
      )
        window.location = "../index.html";

      let guest_details = JSON.parse(sessionStorage.getItem("guest_details"));

      var today = moment();
      var tomorrow = moment(today).add(1, "days");

      $("#guest_name").html(
        guest_details.first_name + " " + guest_details.last_name
      );
      $("#guest_num").html(guest_details.num_guest);
      $("#guest_address").html(guest_details.address);
      $("#guest_contact").html(guest_details.contact_num);
      $("#guest_email").html(guest_details.email);

      let check_in = new Date(sessionStorage.getItem("checkin_date"));
      let check_out = new Date(sessionStorage.getItem("checkout_date"));

      let timediff = check_out.getTime() - check_in.getTime();
      let nights = timediff / (1000 * 3600 * 24);

      $("#check_in").html(
        moment(sessionStorage.getItem("checkin_date")).format(
          "DD MMMM YYYY dddd"
        )
      );
      $("#check_out").html(
        moment(sessionStorage.getItem("checkout_date")).format(
          "DD MMMM YYYY dddd"
        )
      );
      $("#nights").html(nights);

      let room_details = JSON.parse(sessionStorage.getItem("room_details"));

      let sub_total = 0;
      room_details.map((room) => {
        sub_total += room.new_price;
        $("#invoice").append(
          "<tr>" +
            "<td>" +
            room.roomtype_name +
            "</td>" +
            "<td>PHP " +
            room.new_price / room.num_rooms / nights +
            ".00</td>" +
            "<td>" +
            nights +
            "</td>" +
            "<td>" +
            room.num_rooms +
            "</td>" +
            "<td>PHP " +
            room.new_price +
            ".00</td>" +
            "</tr>"
        );
      });

      let total_amount = sub_total;
      let vatable_sales = total_amount / 1.12;
      let VAT = vatable_sales * 0.12;
      let downpayment = total_amount / 2;

      $("#vatable").html("PHP " + vatable_sales.toFixed(2));
      $("#vat").html("PHP " + VAT.toFixed(2));
      $("#sub_total").html("PHP " + total_amount.toFixed(2));
      $("#downpayment").html("PHP " + downpayment.toFixed(2));
      $("#total_amount").html("PHP " + total_amount.toFixed(2));

      let selected_rooms = [];

      $("#confirm").click(() => {
        $("#confirm").attr("disabled", "disabled");
        $.LoadingOverlay("show", {
          image: "",
          progress: true,
        });
        var count = 0;
        var interval = setInterval(function () {
          if (count >= 100) {
            clearInterval(interval);
            $.LoadingOverlay("hide");
            return;
          }
          count += 20;
          $.LoadingOverlay("progress", count);
        }, 300);

        room_details.map((room) => {
          room.room_ids.map((rooms) => {
            selected_rooms.push(rooms);
          });
        });

        let reservation_id = parseInt(
          Date.now().toString().substring(1, 5) +
            parseInt(Math.random().toString().substring(2, 6))
        );

        let guest_id = parseInt(
          Date.now().toString().substring(2, 6) +
            parseInt(Math.random().toString().substring(3, 7))
        );

        let billing_id = parseInt(
          Date.now().toString().substring(3, 7) +
            parseInt(Math.random().toString().substring(4, 8))
        );

        let new_check_in = moment(check_in).format("YYYY-MM-DD");
        let new_check_out = moment(check_out).format("YYYY-MM-DD");

        $.ajax({
          url: "../php_functions/validate_rooms.php",
          data:
            "selected_rooms=" +
            JSON.stringify(selected_rooms) +
            "&checkin_date=" +
            new_check_in +
            "&checkout_date=" +
            new_check_out,
          type: "POST",
          success: function (response) {
            let res = response;
            if (res == '"1"') {
              if (moment(tomorrow._d).format("YYYY-MM-DD") == new_check_in) {
                setTimeout(function () {
                  Swal.fire({
                    icon: "success",
                    title: "Thank You for Booking With Us!",
                    text: "You have until today 11:59PM to pay your downpayment, Please check your e-mail",
                    footer:
                      "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                    timer: 5000,
                    showCancelButton: false,
                    showConfirmButton: false,
                  });
                }, 2100);
              } else {
                setTimeout(function () {
                  Swal.fire({
                    icon: "success",
                    title: "Thank You for Booking With Us!",
                    text: "You have 24 Hours to pay your downpayment, Please check your e-mail",
                    footer:
                      "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                    timer: 5000,
                    showCancelButton: false,
                    showConfirmButton: false,
                  });
                }, 2100);
              }

              $.ajax({
                url: "../php_functions/insert_reservation.php",
                data:
                  "guest_id=" +
                  guest_id +
                  "&first_name=" +
                  guest_details.first_name +
                  "&last_name=" +
                  guest_details.last_name +
                  "&gender=" +
                  guest_details.gender +
                  "&contact_number=" +
                  guest_details.contact_num +
                  "&email=" +
                  guest_details.email +
                  "&address=" +
                  guest_details.address +
                  "&city=" +
                  guest_details.city +
                  "&zip_code=" +
                  guest_details.zipcode +
                  "&reservation_id=" +
                  reservation_id +
                  "&billing_id=" +
                  billing_id +
                  "&checkin_date=" +
                  new_check_in +
                  "&num_guest=" +
                  guest_details.num_guest +
                  "&checkout_date=" +
                  new_check_out +
                  "&reservation_type=" +
                  0 +
                  "&status=" +
                  0 +
                  "&room_details=" +
                  JSON.stringify(room_details),
                type: "POST",
                success: function (response) {
                  localStorage.clear();
                },
              });

              setTimeout(() => {
                window.location = "../index.html";
              }, 7200);
            } else {
              setTimeout(function () {
                Swal.fire({
                  icon: "warning",
                  title: "Oops...",
                  text: "Something went wrong!, Booking Unsuccessfull",
                  footer:
                    "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                  timer: 5000,
                  showCancelButton: false,
                  showConfirmButton: false,
                });
              }, 2100);

              setTimeout(() => {
                window.location = "../index.html";
              }, 7100);
            }
          },
        });
      });
    });
  </script>
</html>
